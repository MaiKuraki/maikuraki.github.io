<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"/><meta name="theme-color" content="#222"/><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/><meta name="renderer" content="webkit"/><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"/><link rel="alternate" href="/rss.xml" title="Cyclone Dimension" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="Cyclone Dimension" type="application/atom+xml"><link rel="alternate" type="application/json" title="Cyclone Dimension" href="http://example.com/feed.json"/><link rel="preconnect" href="https://s4.zstatic.net"/><link rel="preconnect" href="https://at.alicdn.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&display=swap&subset=latin,latin-ext" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/app.css?v=0.4.17"><link rel="modulepreload" href="/js/chunk-CEGCGMOL.js"></link><link rel="modulepreload" href="/js/chunk-GGGFSYNZ.js"></link><link rel="modulepreload" href="/js/chunk-JCRUV7DC.js"></link><link rel="modulepreload" href="/js/chunk-QQDDBAKB.js"></link><link rel="modulepreload" href="/js/copy-tex-GLSWERUN.js"></link><link rel="modulepreload" href="/js/index.esm-JAFUNPUX.js"></link><link rel="modulepreload" href="/js/post-DQCXG5Q7.js"></link><link rel="modulepreload" href="/js/quicklink-X4RVGXH7.js"></link><link rel="modulepreload" href="/js/search-3IHYTYQ2.js"></link><link rel="modulepreload" href="/js/siteInit.js"></link><link rel="preload" href="https://tva4.sinaimg.cn/large/6833939bly1gicis3attqj20zk0m8k7l.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://tva4.sinaimg.cn/large/6833939bly1giciszlczyj20zk0m816d.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://tva4.sinaimg.cn/large/6833939bly1gicis081o9j20zk0m8dmr.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://tva4.sinaimg.cn/large/6833939bly1gicit31ffoj20zk0m8naf.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://tva4.sinaimg.cn/large/6833939bly1gicit4jrvuj20zk0m8785.jpg" as="image" fetchpriority="high"><link rel="preload" href="https://tva4.sinaimg.cn/large/6833939bly1gicitcxhpij20zk0m8hdt.jpg" as="image" fetchpriority="high"><link rel="canonical" href="http://example.com/2024/10/07/Unity_Game_Build_Pipeline_with_TeamCity/"><title>Unity 游戏自动化打包教程【TeamCity】</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Unity 游戏自动化打包教程【TeamCity】</h1><div class="meta"><span class="item" title="Created: 2024-10-07 20:35:14"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">Posted on</span><time itemprop="dateCreated datePublished" datetime="2024-10-07T20:35:14+08:00">2024-10-07</time></span><span class="item" title="Symbols count in article"><span class="icon"><i class="ic i-pen"></i></span><span class="text">Symbols count in article</span><span>18k</span><span class="text">words</span></span><span class="item" title="Reading time"><span class="icon"><i class="ic i-clock"></i></span><span class="text">Reading time</span><span>17 mins.</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Cyclone Dimension</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><ul><li class="item" style="background-image: url(&quot;https://tva4.sinaimg.cn/large/6833939bly1gicis3attqj20zk0m8k7l.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://tva4.sinaimg.cn/large/6833939bly1giciszlczyj20zk0m816d.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://tva4.sinaimg.cn/large/6833939bly1gicis081o9j20zk0m8dmr.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://tva4.sinaimg.cn/large/6833939bly1gicit31ffoj20zk0m8naf.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://tva4.sinaimg.cn/large/6833939bly1gicit4jrvuj20zk0m8785.jpg&quot;);"></li><li class="item" style="background-image: url(&quot;https://tva4.sinaimg.cn/large/6833939bly1gicitcxhpij20zk0m8hdt.jpg&quot;);"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemListElement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">Home</a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="en"><link itemprop="mainEntityOfPage" href="http://example.com/2024/10/07/Unity_Game_Build_Pipeline_with_TeamCity/"/><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.png"/><meta itemprop="name" content="Cyclone"/><meta itemprop="description" content=", "/></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Cyclone Dimension"/></span><div class="body md" itemprop="articleBody"><pre><code>本文目的在于为我们在日常的 Unity 开发过程中标准化构建游戏的发行版本。文章撰写于 2023.2 截至 2024.10 依旧有效，其中涉及到的软件版本均可使用 2024 最新版。
</code></pre>
<h2 id="software-environment-本文所需的系统平台及软件环境"><a class="anchor" href="#software-environment-本文所需的系统平台及软件环境">#</a> Software Environment 本文所需的系统平台及软件环境</h2>
<ul>
<li>Windows
<ul>
<li>Docker</li>
<li>Unity</li>
<li>Wwise (Optional) 可选</li>
</ul>
</li>
<li>Linux
<ul>
<li>不推荐在 Linux 平台使用 Unity 和 TeamCityAgent</li>
<li>Linux 平台不支持 Wwise</li>
<li>即使有一些编辑器脚本可以让 Wwise 代码在 Linux 平台正常编译，依然不推荐 Linux 平台作为 TeamCityAgent</li>
</ul>
</li>
<li>MacOS
<ul>
<li>未测试</li>
</ul>
</li>
</ul>
<h2 id="安装-docker"><a class="anchor" href="#安装-docker">#</a> 安装 Docker</h2>
<h3 id="官网"><a class="anchor" href="#官网">#</a> 官网</h3>
<p><a target="_blank" rel="noopener" href="https://www.docker.com/products/docker-desktop/">Docker Desktop</a></p>
<h3 id="验证"><a class="anchor" href="#验证">#</a> 验证</h3>
<p>安装完成后，打开 docker-desktop，我们会看到 docker 的界面</p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_01.png" alt="Tutorial_01" /></p>
<p>在命令行输入以下命令 (Linux 平台需要加 sudo)</p>
<figure class="highlight bash"><figcaption data-lang="bash"><span>h</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ <span class="token function">docker</span> <span class="token function">ps</span></pre></td></tr></table></figure><p>命令行会显示类似下图打印</p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_02.png" alt="Tutorial_02" /></p>
<h2 id="创建-docker-内部网络"><a class="anchor" href="#创建-docker-内部网络">#</a> 创建 Docker 内部网络</h2>
<p>此处创建 docker 内部的虚拟网络，目的是可以为每个容器分配一个固定的 ip，如果我们的设备在远程，可以方便的使用 <strong> <code>Nginx Proxy Manager</code> </strong> 反向代理到固定域名。</p>
<p>在命令行输入以下命令 (Linux 平台需要加 sudo)</p>
<figure class="highlight bash"><figcaption data-lang="bash"><span>h</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ <span class="token function">docker</span> network create docker_net <span class="token parameter variable">--subnet</span><span class="token operator">=</span><span class="token number">172.20</span>.0.0/16</pre></td></tr></table></figure><p>其中 <strong> <code>docker_net</code> </strong> 是 docker 内部新建网络的名字，可根据实际情况修改。</p>
<h2 id="安装与配置-portainer"><a class="anchor" href="#安装与配置-portainer">#</a> 安装与配置 Portainer</h2>
<h3 id="安装-portainer-ce"><a class="anchor" href="#安装-portainer-ce">#</a> 安装 Portainer-CE</h3>
<p>Portainer 是一款图形化的 docker 管理工具，可以比较方便的管理和调整 docker</p>
<p>在命令行输入命令安装 portainer-ce 注意此命令在命令行的一行中输入 (Linux 平台需要加 sudo)</p>
<figure class="highlight bash"><figcaption data-lang="bash"><span>h</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8000</span>:8000 <span class="token parameter variable">-p</span> <span class="token number">9000</span>:9000 <span class="token parameter variable">-p</span> <span class="token number">9443</span>:9443 <span class="token parameter variable">--name</span> portainer <span class="token parameter variable">--network</span> docker_net <span class="token parameter variable">--ip</span> <span class="token number">172.20</span>.0.2 <span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token parameter variable">-v</span> /var/run/docker.sock:/var/run/docker.sock portainer/portainer-ce:linux-amd64-2.17.0</pre></td></tr></table></figure><p>命令中网络端口，portainer-ce 包的版本，ip，挂载路径可根据实际情况修改。此处 <strong> <code>docker_net</code> </strong> 是上文中创建出的 docker 内部网络</p>
<h3 id="安装-portainer-agent"><a class="anchor" href="#安装-portainer-agent">#</a> 安装 Portainer Agent</h3>
<p>新版的 portainer 可能需要 portainer agent 才可正常添加内部环境<br />
在命令行输入命令安装 portainer agent 注意此命令在命令行的一行中输入 (Linux 平台需要加 sudo)</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">9001</span>:9001 <span class="token parameter variable">--name</span> portainer_agent <span class="token parameter variable">--network</span> docker_net <span class="token parameter variable">--ip</span> <span class="token number">172.20</span>.0.3 <span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token parameter variable">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="token parameter variable">-v</span> /var/lib/docker/volumes:/var/lib/docker/volumes portainer/agent:2.17.0</pre></td></tr></table></figure><p>命令行安装完成后，可以在 docker-desktop 中查看运行状态</p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_03.png" alt="Tutorial_03" /></p>
<h3 id="在浏览器中配置-portainer"><a class="anchor" href="#在浏览器中配置-portainer">#</a> 在浏览器中配置 Portainer</h3>
<p>在浏览器中输入 <strong> <code>localhost:9000</code> </strong> 访问 portainer 管理界面 (9000 端口是上文中 portainer-ce 的对外端口)</p>
<p>点击 <strong> <code>Get Started</code> </strong></p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_04.png" alt="Tutorial_04" /></p>
<p>点击 <strong> <code>Environments</code> </strong> -&gt; <strong> <code>Stacks</code> </strong> -&gt; <strong> <code>Add Stack</code> </strong> 创建容器配置</p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_05.png" alt="Tutorial_05" /></p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_06.png" alt="Tutorial_06" /></p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_07.png" alt="Tutorial_07" /></p>
<h2 id="安装与配置-gitlab-ce"><a class="anchor" href="#安装与配置-gitlab-ce">#</a> 安装与配置 Gitlab-CE</h2>
<h3 id="在-portainer-中安装-gitlab-ce"><a class="anchor" href="#在-portainer-中安装-gitlab-ce">#</a> 在 Portainer 中安装 gitlab-ce</h3>
<p>使用 docker-compose 在 Portainer 中安装 gitlab-ce</p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_08.png" alt="Tutorial_08" /></p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_09.png" alt="Tutorial_09" /></p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_10.png" alt="Tutorial_10" /></p>
<p>以下是 docker-compose yaml 内容</p>
<figure class="highlight yaml"><figcaption data-lang="YAML"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3.9"</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">services</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">gitlab</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> gitlab/gitlab<span class="token punctuation">-</span>ce<span class="token punctuation">:</span>15.9.1<span class="token punctuation">-</span>ce.0</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> gitlab</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"8001:8001"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"8002:22"</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token key atrule">docker_net</span><span class="token punctuation">:</span> <span class="token comment">## 此处 docker_net 对应上文中创建的网络名称</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.20.0.4</pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token punctuation">-</span> /d/Work/Docker/DockerProgram/gitlab/data<span class="token punctuation">:</span>/var/opt/gitlab <span class="token comment">## 此挂载路径在 Windows 中对应 D:\Work\Docker\DockerProgram\gitlab</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token punctuation">-</span> /d/Work/Docker/DockerProgram/gitlab/logs<span class="token punctuation">:</span>/var/log/gitlab</pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token punctuation">-</span> /d/Work/Docker/DockerProgram/gitlab/config<span class="token punctuation">:</span>/etc/gitlab</pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token key atrule">shm_size</span><span class="token punctuation">:</span> <span class="token string">'256m'</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token key atrule">GITLAB_OMNIBUS_CONFIG</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></pre></td></tr><tr><td data-num="19"></td><td><pre>        external_url 'http://localhost:8001'</pre></td></tr><tr><td data-num="20"></td><td><pre>        gitlab_rails['gitlab_shell_ssh_port'] = 8002</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always</pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token key atrule">docker_net</span><span class="token punctuation">:</span> <span class="token comment">## 此处 docker_net 对应上文中创建的网络名称</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token key atrule">name</span><span class="token punctuation">:</span> docker_net</pre></td></tr></table></figure><h3 id="配置使用-gitlab"><a class="anchor" href="#配置使用-gitlab">#</a> 配置使用 Gitlab</h3>
<p>在 gitlab 创建完成后，找到 gitlab 配置文件，查看 root 密码。上文中 yaml 中挂载了路径  <code>/d/Work/Docker/DockerProgram/gitlab/config</code> <br />
 对应 Windows 磁盘中  <code>D:\Work\Docker\DockerProgram\gitlab\config</code> , 访问路径找到文件  <code>initial_root_password</code>  以文本形式打开后找到 gitlab 初始 root 密码</p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_11.png" alt="Tutorial_11" /></p>
<p>在浏览器中输入 localhost:8001 (8001 端口是上文中 gitlab 的对外端口) 访问 gitlab 主页，请使用账号  <code>root</code>  与  <code>initial_root_password</code>  文件中查到的密码进行首次登录。请自行创建私有账号和新的空项目</p>
<h3 id="创建和上传游戏项目"><a class="anchor" href="#创建和上传游戏项目">#</a> 创建和上传游戏项目</h3>
<p>在本地创建游戏项目并上传至 gitlab</p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_12.png" alt="Tutorial_12" /></p>
<p>项目结构</p>
<pre><code>&lt;root&gt;
    ├─DemoGame_Unity
    |       ├─Assets
    |       |   ├─Editor
    |       |   |   └─BuildScript.cs
    |       |   ├─Scene
    |       |   |   └─SampleScene.unity
    |       |   └─...
    |       └─...
    ├─DemoGame_Wwise
    |       └─...
    └─README.md
</code></pre>
<p><code>BuildScript.cs</code>  <strong>必须</strong>存放在 Unity 项目 Assets/Editor 路径下，目的是可以在 TeamCity 里拿到它</p>
<figure class="highlight cs"><figcaption data-lang="C#"><span>s</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>IO</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">UnityEditor</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">UnityEditor<span class="token punctuation">.</span>Build<span class="token punctuation">.</span>Reporting</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">UnityEngine</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">namespace</span> <span class="token namespace">DemoGame<span class="token punctuation">.</span>Editor</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BuildScript</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MonoBehaviour</span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> DEBUG_FLAG <span class="token operator">=</span> <span class="token string">"[Game Builder]"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> INVALID_FLAG <span class="token operator">=</span> <span class="token string">"INVALID"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> ApplicationName <span class="token operator">=</span> <span class="token string">"DemoGame"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> OutputBasePath <span class="token operator">=</span> <span class="token string">"Build"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> OutputPath_Android <span class="token operator">=</span> <span class="token string">"Android"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token class-name"><span class="token keyword">string</span></span> OutputPath_Windows <span class="token operator">=</span> <span class="token string">"Windows"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">MenuItem</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Build/Build Android APK (IL2CPP)"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PerformBuild_AndroidAPK</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            EditorUserBuildSettings<span class="token punctuation">.</span>exportAsGoogleAndroidProject <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token function">PerformBuild</span><span class="token punctuation">(</span>BuildTarget<span class="token punctuation">.</span>Android<span class="token punctuation">,</span> BuildTargetGroup<span class="token punctuation">.</span>Android<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                ScriptingImplementation<span class="token punctuation">.</span>IL2CPP<span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">OutputPath_Android</span><span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">ApplicationName</span><span class="token punctuation">&#125;</span></span><span class="token string">.apk"</span></span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">bCleanBuild</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                <span class="token named-parameter punctuation">bOutputIsFolderTarget</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">MenuItem</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Build/Build Windows (IL2CPP)"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PerformBuild_Windows</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            <span class="token function">PerformBuild</span><span class="token punctuation">(</span>BuildTarget<span class="token punctuation">.</span>StandaloneWindows64<span class="token punctuation">,</span> BuildTargetGroup<span class="token punctuation">.</span>Standalone<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                ScriptingImplementation<span class="token punctuation">.</span>IL2CPP<span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">OutputPath_Windows</span><span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">ApplicationName</span><span class="token punctuation">&#125;</span></span><span class="token string">.exe"</span></span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">bCleanBuild</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                <span class="token named-parameter punctuation">bOutputIsFolderTarget</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">MenuItem</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Build/Export Android Project (IL2CPP)"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PerformBuild_AndroidProject</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>            EditorUserBuildSettings<span class="token punctuation">.</span>exportAsGoogleAndroidProject <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token function">PerformBuild</span><span class="token punctuation">(</span>BuildTarget<span class="token punctuation">.</span>Android<span class="token punctuation">,</span> BuildTargetGroup<span class="token punctuation">.</span>Android<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="41"></td><td><pre>                ScriptingImplementation<span class="token punctuation">.</span>IL2CPP<span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">OutputPath_Android</span><span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">ApplicationName</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">bCleanBuild</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="42"></td><td><pre>                <span class="token named-parameter punctuation">bOutputIsFolderTarget</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PerformBuild</span><span class="token punctuation">(</span><span class="token class-name">BuildTarget</span> TargetPlatform<span class="token punctuation">,</span> <span class="token class-name">BuildTargetGroup</span> TargetGroup<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="46"></td><td><pre>            <span class="token class-name">ScriptingImplementation</span> BackendScriptImpl<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> OutputTarget<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> bCleanBuild <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="47"></td><td><pre>            <span class="token class-name"><span class="token keyword">bool</span></span> bOutputIsFolderTarget <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>bCleanBuild<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>                <span class="token function">DeletePlatformBuildFolder</span><span class="token punctuation">(</span>TargetPlatform<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>            </pre></td></tr><tr><td data-num="54"></td><td><pre>            <span class="token class-name"><span class="token keyword">var</span></span> buildPlayerOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">BuildPlayerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>            buildPlayerOptions<span class="token punctuation">.</span>scenes <span class="token operator">=</span> <span class="token function">GetBuildSceneList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>            buildPlayerOptions<span class="token punctuation">.</span>locationPathName <span class="token operator">=</span> <span class="token function">GetOutputTarget</span><span class="token punctuation">(</span>TargetPlatform<span class="token punctuation">,</span> OutputTarget<span class="token punctuation">,</span> bOutputIsFolderTarget<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>            buildPlayerOptions<span class="token punctuation">.</span>target <span class="token operator">=</span> TargetPlatform<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>            buildPlayerOptions<span class="token punctuation">.</span>options <span class="token operator">=</span> BuildOptions<span class="token punctuation">.</span>CleanBuildCache<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>            PlayerSettings<span class="token punctuation">.</span><span class="token function">SetScriptingBackend</span><span class="token punctuation">(</span>TargetGroup<span class="token punctuation">,</span> BackendScriptImpl<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre>            <span class="token class-name"><span class="token keyword">var</span></span> report <span class="token operator">=</span> BuildPipeline<span class="token punctuation">.</span><span class="token function">BuildPlayer</span><span class="token punctuation">(</span>buildPlayerOptions<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>            <span class="token class-name"><span class="token keyword">var</span></span> summary <span class="token operator">=</span> report<span class="token punctuation">.</span>summary<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre></pre></td></tr><tr><td data-num="64"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>summary<span class="token punctuation">.</span>result <span class="token operator">==</span> BuildResult<span class="token punctuation">.</span>Succeeded<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre>                Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">DEBUG_FLAG</span><span class="token punctuation">&#125;</span></span><span class="token string"> Build succeed, size: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">summary<span class="token punctuation">.</span>totalSize</span><span class="token punctuation">&#125;</span></span><span class="token string"> bytes"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre></pre></td></tr><tr><td data-num="67"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>summary<span class="token punctuation">.</span>result <span class="token operator">==</span> BuildResult<span class="token punctuation">.</span>Failed<span class="token punctuation">)</span> Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">DEBUG_FLAG</span><span class="token punctuation">&#125;</span></span><span class="token string"> Build failed"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="69"></td><td><pre></pre></td></tr><tr><td data-num="70"></td><td><pre>        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetPlatformOutputFolder</span><span class="token punctuation">(</span><span class="token class-name">BuildTarget</span> TargetPlatform<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="71"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>            <span class="token keyword">switch</span> <span class="token punctuation">(</span>TargetPlatform<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="73"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>                <span class="token keyword">case</span> BuildTarget<span class="token punctuation">.</span>Android<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="75"></td><td><pre>                    <span class="token keyword">return</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">OutputBasePath</span><span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">OutputPath_Android</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>                <span class="token keyword">case</span> BuildTarget<span class="token punctuation">.</span>StandaloneWindows64<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="77"></td><td><pre>                    <span class="token keyword">return</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">OutputBasePath</span><span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">OutputPath_Windows</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="79"></td><td><pre></pre></td></tr><tr><td data-num="80"></td><td><pre>            <span class="token keyword">return</span> INVALID_FLAG<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="82"></td><td><pre>        </pre></td></tr><tr><td data-num="83"></td><td><pre>        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DeletePlatformBuildFolder</span><span class="token punctuation">(</span><span class="token class-name">BuildTarget</span> TargetPlatform<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="84"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="85"></td><td><pre>            <span class="token class-name"><span class="token keyword">string</span></span> platformOutputPath <span class="token operator">=</span> <span class="token function">GetPlatformOutputFolder</span><span class="token punctuation">(</span>TargetPlatform<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>            <span class="token class-name"><span class="token keyword">string</span></span> platformOutputFullPath <span class="token operator">=</span></pre></td></tr><tr><td data-num="87"></td><td><pre>                platformOutputPath <span class="token operator">!=</span> <span class="token return-type class-name">INVALID_FLAG <span class="token punctuation">?</span></span> Path<span class="token punctuation">.</span><span class="token function">GetFullPath</span><span class="token punctuation">(</span>platformOutputPath<span class="token punctuation">)</span> <span class="token punctuation">:</span> INVALID_FLAG<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>Directory<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>platformOutputFullPath<span class="token punctuation">)</span><span class="token punctuation">)</span> Directory<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>platformOutputFullPath<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="90"></td><td><pre></pre></td></tr><tr><td data-num="91"></td><td><pre>        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetOutputTarget</span><span class="token punctuation">(</span><span class="token class-name">BuildTarget</span> TargetPlatform<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> TargetPath<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="92"></td><td><pre>            <span class="token class-name"><span class="token keyword">bool</span></span> bTargetIsFolder <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="93"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="94"></td><td><pre>            <span class="token class-name"><span class="token keyword">string</span></span> PlatformOutFolder <span class="token operator">=</span> <span class="token function">GetPlatformOutputFolder</span><span class="token punctuation">(</span>TargetPlatform<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="95"></td><td><pre>            <span class="token class-name"><span class="token keyword">string</span></span> resultPath <span class="token operator">=</span> Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>OutputBasePath<span class="token punctuation">,</span> TargetPath<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="96"></td><td><pre>            Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="97"></td><td><pre>                <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">DEBUG_FLAG</span><span class="token punctuation">&#125;</span></span><span class="token string"> result path: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">resultPath</span><span class="token punctuation">&#125;</span></span><span class="token string">, platformFolder: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">PlatformOutFolder</span><span class="token punctuation">&#125;</span></span><span class="token string">, platform fullPath:</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">Path<span class="token punctuation">.</span><span class="token function">GetFullPath</span><span class="token punctuation">(</span>PlatformOutFolder<span class="token punctuation">)</span></span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="98"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Directory<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>Path<span class="token punctuation">.</span><span class="token function">GetFullPath</span><span class="token punctuation">(</span>PlatformOutFolder<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> Directory<span class="token punctuation">.</span><span class="token function">CreateDirectory</span><span class="token punctuation">(</span>PlatformOutFolder<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="99"></td><td><pre><span class="token preprocessor property">#<span class="token directive keyword">if</span> UNITY_IOS</span></pre></td></tr><tr><td data-num="100"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Directory<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">resultPath</span><span class="token punctuation">&#125;</span></span><span class="token string">/Unity-iPhone/Images.xcassets/LaunchImage.launchimage"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="101"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="102"></td><td><pre>                Directory<span class="token punctuation">.</span><span class="token function">CreateDirectory</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">resultPath</span><span class="token punctuation">&#125;</span></span><span class="token string">/Unity-iPhone/Images.xcassets/LaunchImage.launchimage"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="103"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="104"></td><td><pre><span class="token preprocessor property">#<span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num="105"></td><td><pre>            <span class="token keyword">return</span> resultPath<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="106"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="107"></td><td><pre></pre></td></tr><tr><td data-num="108"></td><td><pre>        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">GetBuildSceneList</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="109"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="110"></td><td><pre>            <span class="token class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">></span></span> sceneList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="111"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="112"></td><td><pre>                <span class="token string">"Assets/Scene/SampleScene.unity"</span></pre></td></tr><tr><td data-num="113"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="114"></td><td><pre>            <span class="token keyword">return</span> sceneList<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="115"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="116"></td><td><pre>        </pre></td></tr><tr><td data-num="117"></td><td><pre>        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">MenuItem</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Build/Print Debug Info"</span><span class="token punctuation">,</span> priority <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="118"></td><td><pre>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">PrintDebugInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="119"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="120"></td><td><pre>            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> scene_name <span class="token keyword">in</span> <span class="token function">GetBuildSceneList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="121"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="122"></td><td><pre>                Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">DEBUG_FLAG</span><span class="token punctuation">&#125;</span></span><span class="token string"> Pre Build Scene: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">scene_name</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="123"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="124"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="125"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="126"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="安装与配置-teamcity-server"><a class="anchor" href="#安装与配置-teamcity-server">#</a> 安装与配置 TeamCity Server</h2>
<h3 id="在-portainer-中安装-teamcity-server"><a class="anchor" href="#在-portainer-中安装-teamcity-server">#</a> 在 Portainer 中安装 teamcity-server</h3>
<p>以下是 yaml 内容</p>
<figure class="highlight yaml"><figcaption data-lang="YAML"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">---</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">services</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">teamcity-server</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> jetbrains/teamcity<span class="token punctuation">-</span>server<span class="token punctuation">:</span>2022.10.2</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> teamcity<span class="token punctuation">-</span>server</pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token comment"># these two folder must be valid and approved, maybe use chown -R 1000:1000 </span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token punctuation">-</span> /d/Work/Docker/DockerProgram/teamcity_server/datadir<span class="token punctuation">:</span>/data/teamcity_server/datadir</pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token punctuation">-</span> /d/Work/Docker/DockerProgram/teamcity_server/logs<span class="token punctuation">:</span>/opt/teamcity/logs</pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token punctuation">-</span> 8003<span class="token punctuation">:</span><span class="token number">8111</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token key atrule">docker_net</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.20.0.5</pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped </pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token comment"># teamcity-agent:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token comment"># image: jetbrains/teamcity-agent:2022.10.2</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment"># container_name: teamcity-agent</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment"># volumes:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>      <span class="token comment"># # these two folder must be valid and approved, maybe use chown -R 1000:1000</span></pre></td></tr><tr><td data-num="22"></td><td><pre>      <span class="token comment"># - /mnt/HDD/docker_program/teamcity_agent/config:/data/teamcity_agent/conf</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment"># # environment:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>      <span class="token comment"># # this is device real ip not docker inner ip</span></pre></td></tr><tr><td data-num="25"></td><td><pre>      <span class="token comment"># # SERVER_URL: '192.168.50.11:8003'</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token key atrule">docker_net</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>      <span class="token key atrule">name</span><span class="token punctuation">:</span> docker_net</pre></td></tr></table></figure><p><strong>不推荐</strong>在 docker 中安装 teamcity-agent。</p>
<p>安装后可以看到 teamcity-server 在正常运行</p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_13.png" alt="Tutorial_13" /></p>
<p>通过浏览器访问  <code>localhost:8003</code>  进入 teamcity-server 的管理页面，初始化创建账号后进入 teamcity</p>
<h3 id="创建-teamcity-项目"><a class="anchor" href="#创建-teamcity-项目">#</a> 创建 teamcity 项目</h3>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_14.png" alt="Tutorial_14" /></p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_15.png" alt="Tutorial_15" /></p>
<p>此处的  <code>http://localhost:8001/YOUR_USER_NAME/YOUR_PROJECT_NAME.git</code>  地址如果是以 localhost 作为地址，那么在 docker 容器中的 teamcity-server 拿到的  <code>localhost</code>  是 docker 内部的 ip 地址，需要根据你的实际情况替换成你的版本设备 ip，如果需要在同一个设备中使用 teamcity-server 与 gitlab 服务，请将  <code>localhost</code>  替换为 docker 内部 ip，比如  <code>http://172.20.0.4:8001/mai/DemoGame.git</code></p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_16.png" alt="Tutorial_16" /></p>
<h3 id="为-teamcity-server-配置-unity-build-plugin"><a class="anchor" href="#为-teamcity-server-配置-unity-build-plugin">#</a> 为 teamcity-server 配置 Unity build plugin</h3>
<ul>
<li>
<p>我们可以访问 github 或者 teamcity 官网下载</p>
<ul>
<li>
<p><a target="_blank" rel="noopener" href="https://github.com/JetBrains/teamcity-unity-plugin">Github Page</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://plugins.jetbrains.com/plugin/11453-unity-support">Teamcity Page</a></p>
</li>
</ul>
</li>
<li>
<p>下载后得到  <code>plugin-unity-server.zip</code> ，点击  <code>[Administration]</code>  -&gt;  <code>[Plugins]</code>  -&gt;  <code> [Upload plugin zip]</code>  -&gt;  <code>[Enable uploaded plugins]</code>  安装并启用 teamcity-server 的 Unity Build 插件</p>
</li>
</ul>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_17.png" alt="Tutorial_17" /></p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_18.png" alt="Tutorial_18" /></p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_19.png" alt="Tutorial_19" /></p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_20.png" alt="Tutorial_20" /></p>
<ul>
<li>安装好插件后，点击  <code>[Projects]</code>  -&gt;  <code>[Build Android]</code>  -&gt;  <code>[Edit configuration]</code>  -&gt;  <code>[Build Steps]</code>  来编辑 BuildStep</li>
</ul>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_21.png" alt="Tutorial_21" /></p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_22.png" alt="Tutorial_22" /></p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_23.png" alt="Tutorial_23" /></p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_24.png" alt="Tutorial_24" /></p>
<ul>
<li>点击  <code>[Add build step]</code>  搜索  <code>unity</code>  进入配置</li>
</ul>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_25.png" alt="Tutorial_25" /></p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_26.png" alt="Tutorial_26" /></p>
<ul>
<li>选择 Project Path 与  <code>BuildScript.cs</code>  中的打包方法</li>
</ul>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_27.png" alt="Tutorial_27" /></p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_28.png" alt="Tutorial_28" /></p>
<ul>
<li>添加命令行参数</li>
</ul>
<figure class="highlight bash"><figcaption data-lang="bash"><span>h</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ <span class="token parameter variable">-nographics</span> <span class="token parameter variable">-logFile</span> -</pre></td></tr></table></figure><p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_29.png" alt="Tutorial_29" /></p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_30.png" alt="Tutorial_30" /></p>
<ul>
<li>回到 General Settings 配置打包输出路径</li>
</ul>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_31.png" alt="Tutorial_31" /></p>
<figure class="highlight bash"><figcaption data-lang="bash"><span>h</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ DemoGame_Unity/Build/Android <span class="token operator">=</span><span class="token operator">></span> Build-Android</pre></td></tr></table></figure><p>此处  <code>DemoGame_Unity/Build/Android</code>  输出路径可以在 Unity 项目的 BuildScript.cs 中更改</p>
<h2 id="安装与配置-teamcity-agent"><a class="anchor" href="#安装与配置-teamcity-agent">#</a> 安装与配置 TeamCity Agent</h2>
<p>TeamCity Agent 是实际用来控制打包机器的程序，它会直接调设备中的 Unity 程序来进行项目打包。</p>
<h3 id="安装-teamcity-windows"><a class="anchor" href="#安装-teamcity-windows">#</a> 安装 TeamCity Windows</h3>
<p><a target="_blank" rel="noopener" href="https://www.jetbrains.com/teamcity/download/">Download TeamCity</a></p>
<p>安装完成后自动配置时，建议使用系统账号，windows 的 user 账号可能会有权限不足的报错</p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_35.png" alt="Tutorial_35" /></p>
<p>假如安装路径是  <code>D:\Software\TeamCity</code></p>
<p>修改  <code>D:\Software\TeamCity\buildAgent\conf</code>  路径下文件  <code>buildAgent.dist.properties</code>  大约第 9 行改为  <code>serverUrl=http://localhost:8003/</code> ，并且在文件底部添加两行配置</p>
<figure class="highlight bash"><figcaption data-lang="bash"><span>h</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token assign-left variable">unity.path</span><span class="token operator">=</span>D:<span class="token punctuation">\</span>Software<span class="token punctuation">\</span>Unity<span class="token punctuation">\</span>Editor</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token assign-left variable">env.UNITY_HINT_PATH</span><span class="token operator">=</span>D:<span class="token punctuation">\</span>Software<span class="token punctuation">\</span>Unity<span class="token punctuation">\</span>Editor</pre></td></tr></table></figure><p>注意  <code>D:\Software\Unity\Editor</code>  是 UnityHub 中设置的 Unity Editor 安装路径</p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_32.png" alt="Tutorial_32" /></p>
<p>修改  <code>D:\Software\TeamCity\buildAgent\conf</code>  路径下文件  <code>buildAgent.properties</code>  内容，大约第 1 行改为  <code>serverUrl=http\://localhost\:8003</code></p>
<figure class="highlight bash"><figcaption data-lang="bash"><span>h</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token assign-left variable">serverUrl</span><span class="token operator">=</span>http<span class="token punctuation">\</span>://localhost<span class="token punctuation">\</span>:8003</pre></td></tr></table></figure><p>如果  <code>buildAgent.properties</code>  文件内容类似下图，那么配置文件应该是没有问题了</p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_36.png" alt="Tutorial_36" /></p>
<h3 id="启动-teamcity-agent"><a class="anchor" href="#启动-teamcity-agent">#</a> 启动 TeamCity Agent</h3>
<p>用命令行进入  <code>D:\Software\TeamCity\buildAgent\bin</code></p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_33.png" alt="Tutorial_33" /></p>
<p>输入命令  <code>./agent.bat start</code>  启动 TeamCity Agent</p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_34.png" alt="Tutorial_34" /></p>
<figure class="highlight bash"><figcaption data-lang="bash"><span>h</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ ./agent.bat start</pre></td></tr></table></figure><h2 id="在-teamcity-server-中完成项目配置"><a class="anchor" href="#在-teamcity-server-中完成项目配置">#</a> 在 TeamCity Server 中完成项目配置</h2>
<h3 id="注册并启用-agent"><a class="anchor" href="#注册并启用-agent">#</a> 注册并启用 Agent</h3>
<p>浏览器访问  <code>http://localhost:8003</code>  访问  <code>[Agents]</code>  -&gt;  <code>[Unauthorized]</code>  在右侧分别点击  <code>[Authorize]</code>  与  <code>[Enable]</code>  来注册和启动打包机</p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_37.png" alt="Tutorial_37" /></p>
<h3 id="开始打包"><a class="anchor" href="#开始打包">#</a> 开始打包</h3>
<p>回到  <code>[Project]</code>  点击  <code>[Run]</code>  开始打包</p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_38.png" alt="Tutorial_38" /></p>
<h2 id="issues"><a class="anchor" href="#issues">#</a> Issues</h2>
<h3 id="连接-git-失败"><a class="anchor" href="#连接-git-失败">#</a> 连接 git 失败</h3>
<p>如果我们完全按照上文创建 gitlab 与 teamcity-server，在 windows 端的 docker 中同时运行 teamcity-server 和 gitlab 会出现找不到打包地址的问题</p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_42.png" alt="Tutorial_42" /></p>
<p>目前尚未知原因，我的解决办法是在本地局域网内另一台设备部署了 gitlab 服务，将 teamcity-server 中的地址替换为局域网内另一台机器的真实 ip，然后再次打包即可成功。还可以在安装 teamcity-agent 的时候同时选择安装 windows 版的 teamcity-server，应该也可以解决同机器无法访问 git 的问题。</p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_39.png" alt="Tutorial_39" /></p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_40.png" alt="Tutorial_40" /></p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_41.png" alt="Tutorial_41" /></p>
<h3 id="找不到-unity"><a class="anchor" href="#找不到-unity">#</a> 找不到 unity</h3>
<p><code>Failed to start build runner 'unity'</code></p>
<p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_43.png" alt="Tutorial_43" /></p>
<p>遇到这个问题请用命令行进入  <code>D:\Software\TeamCity\buildAgent\bin</code></p>
<p>重新输入  <code>./agent.bat stop</code>   <code>./agent.bat start</code>  这两条命令解决，它会重启并应用配置文件中的 unity 路径配置。</p>
<figure class="highlight bash"><figcaption data-lang="bash"><span>h</span></figcaption><table><tr><td data-num="1"></td><td><pre>$ ./agent.bat stop</pre></td></tr><tr><td data-num="2"></td><td><pre>$ ./agent.bat start</pre></td></tr></table></figure><p><img loading="lazy" data-src="https://cdn.jsdelivr.net/gh/maikuraki/jsdelivr@v0.0.6/docimg/UnityBuildPipelineTutorial/tutorial_44.png" alt="Tutorial_44" /></p>
</div><footer><div class="meta"></div><div class="reward"><button><i class="ic i-heartbeat"></i>Donate</button><p>Give me a cup of [coffee]~(￣▽￣)~*</p><div id="qr"><div><img loading="lazy" data-src="/assets/wechatpay.png" alt="Cyclone WeChat Pay"/><p>WeChat Pay</p></div><div><img loading="lazy" data-src="/assets/alipay.png" alt="Cyclone Alipay"/><p>Alipay</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>Cyclone<i class="ic i-at"><em>@</em></i>Cyclone Dimension</li><li class="link"><strong>Post link: </strong><a href="http://example.com/2024/10/07/Unity_Game_Build_Pipeline_with_TeamCity/" title="Unity 游戏自动化打包教程【TeamCity】">http://example.com/2024/10/07/Unity_Game_Build_Pipeline_with_TeamCity/</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> unless stating additionally.</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/10/07/hello-world/" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gicitcxhpij20zk0m8hdt.jpg" title="Hello World"><span class="type">Previous Post</span><h3>Hello World</h3></a></div><div class="item right"><a href="/2024/10/07/Unity_WebGL_Demo/" rel="next" itemprop="url" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gicis3attqj20zk0m8k7l.jpg" title="Unity WebGL Demo"><span class="type">Next Post</span><h3>Unity WebGL Demo</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#software-environment-%E6%9C%AC%E6%96%87%E6%89%80%E9%9C%80%E7%9A%84%E7%B3%BB%E7%BB%9F%E5%B9%B3%E5%8F%B0%E5%8F%8A%E8%BD%AF%E4%BB%B6%E7%8E%AF%E5%A2%83"><span class="toc-number">1.</span> <span class="toc-text"> Software Environment 本文所需的系统平台及软件环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-docker"><span class="toc-number">2.</span> <span class="toc-text"> 安装 Docker</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%98%E7%BD%91"><span class="toc-number">2.1.</span> <span class="toc-text"> 官网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81"><span class="toc-number">2.2.</span> <span class="toc-text"> 验证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-docker-%E5%86%85%E9%83%A8%E7%BD%91%E7%BB%9C"><span class="toc-number">3.</span> <span class="toc-text"> 创建 Docker 内部网络</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE-portainer"><span class="toc-number">4.</span> <span class="toc-text"> 安装与配置 Portainer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-portainer-ce"><span class="toc-number">4.1.</span> <span class="toc-text"> 安装 Portainer-CE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-portainer-agent"><span class="toc-number">4.2.</span> <span class="toc-text"> 安装 Portainer Agent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E9%85%8D%E7%BD%AE-portainer"><span class="toc-number">4.3.</span> <span class="toc-text"> 在浏览器中配置 Portainer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE-gitlab-ce"><span class="toc-number">5.</span> <span class="toc-text"> 安装与配置 Gitlab-CE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-portainer-%E4%B8%AD%E5%AE%89%E8%A3%85-gitlab-ce"><span class="toc-number">5.1.</span> <span class="toc-text"> 在 Portainer 中安装 gitlab-ce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8-gitlab"><span class="toc-number">5.2.</span> <span class="toc-text"> 配置使用 Gitlab</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E4%B8%8A%E4%BC%A0%E6%B8%B8%E6%88%8F%E9%A1%B9%E7%9B%AE"><span class="toc-number">5.3.</span> <span class="toc-text"> 创建和上传游戏项目</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE-teamcity-server"><span class="toc-number">6.</span> <span class="toc-text"> 安装与配置 TeamCity Server</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-portainer-%E4%B8%AD%E5%AE%89%E8%A3%85-teamcity-server"><span class="toc-number">6.1.</span> <span class="toc-text"> 在 Portainer 中安装 teamcity-server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA-teamcity-%E9%A1%B9%E7%9B%AE"><span class="toc-number">6.2.</span> <span class="toc-text"> 创建 teamcity 项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA-teamcity-server-%E9%85%8D%E7%BD%AE-unity-build-plugin"><span class="toc-number">6.3.</span> <span class="toc-text"> 为 teamcity-server 配置 Unity build plugin</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE-teamcity-agent"><span class="toc-number">7.</span> <span class="toc-text"> 安装与配置 TeamCity Agent</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-teamcity-windows"><span class="toc-number">7.1.</span> <span class="toc-text"> 安装 TeamCity Windows</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8-teamcity-agent"><span class="toc-number">7.2.</span> <span class="toc-text"> 启动 TeamCity Agent</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8-teamcity-server-%E4%B8%AD%E5%AE%8C%E6%88%90%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE"><span class="toc-number">8.</span> <span class="toc-text"> 在 TeamCity Server 中完成项目配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E5%B9%B6%E5%90%AF%E7%94%A8-agent"><span class="toc-number">8.1.</span> <span class="toc-text"> 注册并启用 Agent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E6%89%93%E5%8C%85"><span class="toc-number">8.2.</span> <span class="toc-text"> 开始打包</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#issues"><span class="toc-number">9.</span> <span class="toc-text"> Issues</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5-git-%E5%A4%B1%E8%B4%A5"><span class="toc-number">9.1.</span> <span class="toc-text"> 连接 git 失败</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%BE%E4%B8%8D%E5%88%B0-unity"><span class="toc-number">9.2.</span> <span class="toc-text"> 找不到 unity</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="Related"></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="Cyclone" src="/assets/avatar.png"/><p class="name" itemprop="name">Cyclone</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">5</span><span class="name">posts</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/yourname" class="item github" title="https:&#x2F;&#x2F;github.com&#x2F;yourname"><i class="ic i-github"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2024/10/07/Unity_WebGL_Demo/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2024/10/07/hello-world/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>Random Posts</h2><ul><li class="item"><div class="breadcrumb"></div><span><a href="/2024/10/07/Unity_Game_Build_Pipeline_with_TeamCity/">Unity 游戏自动化打包教程【TeamCity】</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/10/06/Clean_Linux/">清理 Linux 磁盘</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/10/06/Game_Jam_Log/">Game Jam 记录</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/10/07/Unity_WebGL_Demo/">Unity WebGL Demo</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/10/07/hello-world/">Hello World</a></span></li></ul></div><div class="rpost pjax"><h2>Recent Comments</h2></div></div><div class="status"><div class="copyright">&copy; 2022 -<span itemprop="copyrightYear">2025</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">Cyclone @ Cyclone Dimension</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="Symbols count total">23k words</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="Reading time total">21 mins.</span></div><div class="powered-by">Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
    ispost: true,
        path: `2024/10/07/Unity_Game_Build_Pipeline_with_TeamCity/`,
        favicon: {
        show: `(●´3｀●) Here we go again.`,
        hide: `(´Д｀) It's a disaster!`
    },
    search: {
        placeholder: "Search for Posts",
        empty: "We didn't find any results for the search: ${query}",
        stats: "${hits} results found in ${time} ms"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">Article Timeliness Alert</span><br>This is an article published {{publish}} days ago and last updated {{updated}} days ago. Some information may have changed, so please be careful to screen it.</p></div>`,
    quiz: {
        choice: `Multiple Choice`,
        multiple: `Multiple Answer`,
        true_false: `True/False`,
        essay: `Questions`,
        gap_fill: `Gap Filling`,
        mistake: `Wrong Answer`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};
</script><script src="https://s4.zstatic.net/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha384-ZvpUoO&#x2F;+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn&#x2F;6Z&#x2F;hRTt8+pR6L4N2" crossorigin="anonymous" fetchpriority="high"></script><script src="/js/siteInit.js?v=0.4.17" type="module" fetchpriority="high" defer></script></body></html>